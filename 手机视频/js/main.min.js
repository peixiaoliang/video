    var wxurl = window.location.href;
    $.ajax({
      url: "http://www.ikekeba.com/wxtools/sign.php",
      type: "get",
      async: false,
      data: { wxurl: wxurl},
      dataType: "jsonp",
      jsonpCallback: "WeChatSDKjsonpCallback",
      success: function(wxData) {
        wx.config({
          debug: false,
          appId: wxData.appId,
          timestamp: wxData.timestamp,
          nonceStr: wxData.nonceStr,
          signature: wxData.signature,
          jsApiList: [
            'onMenuShareTimeline',
            'onMenuShareAppMessage'
          ]
        });
      }
    });

    wx.ready(function () {
      var shareData = {
        title: '第一届文物戏精大会',
        desc: '每一个千年文物，都深藏抖音绝技。',
        link: 'http://www.ikekeba.com/museum/',
        imgUrl: 'http://www.ikekeba.com/museum/img/share.jpeg'
      };
      wx.onMenuShareAppMessage(shareData);
      wx.onMenuShareTimeline(shareData);
    });

    var video = document.getElementById("video"),
        $video = $('#video'),
        mask = $('#mask'),
        userAgent = window.navigator.userAgent.toLowerCase(),
        isMobile = {
          Android: function () {
              return navigator.userAgent.match(/Android/i);
          },
          BlackBerry: function () {
              return navigator.userAgent.match(/BlackBerry/i);
          },
          iOS: function () {
              return navigator.userAgent.match(/iPhone|iPad|iPod/i);
          },
          Opera: function () {
              return navigator.userAgent.match(/Opera Mini/i);
          },
          Windows: function () {
              return navigator.userAgent.match(/IEMobile/i);
          },
          any: function () {
              return (isMobile.Android() || isMobile.BlackBerry() || isMobile.iOS() || isMobile.Opera() || isMobile.Windows());
          }
        },
        manifest = [
          "img/0.png",
          "img/1.png",
          "img/2.png",
          "img/3.png",
          "img/4.png",
          "img/5.png",
          "img/6.png",
          "img/7.png",
          "img/8.png",
          "img/9.png",
          "img/bg.jpg",
          "img/right_btn.png",
          "img/load_text.png",
          "img/mask_text.png"
        ];

  video.controls = false;
  //iphone X
  if (screen.height > 760) {
    $('body').addClass('iphoneX');
    $('.bg').attr('src',"./img/bg1448.jpg");
    $video.attr('src',"./video/video1448.mp4");
    video.load();
  }

  if ( isMobile.any() ) {
    preload();
  } else {
    //pc
    $('body').addClass('desktop');
  }

  document.body.addEventListener('touchmove', function (e) {
    e.preventDefault();
  }, {passive: false});

  function preload() {
    var imgLoad = 0;
    var imgTotal = manifest.length;
    var percent = 0;

    $.each(manifest, function( i, val ){

      var img = new Image();
      $(img).load(function(){
        imgLoad += 1;

        percent = parseInt(imgLoad / imgTotal * 100, 10);
        $('.number').html(percent+'%');

        if(percent == 100){
            videoPlayEvents();
            if (userAgent.match(/MicroMessenger/i)=="micromessenger") {
              //mobile
              if ( !isMobile.iOS() ) {
                $('#load').fadeOut(300);
                mask.on("click",function(){
                  video.play();
                  setTimeout(function() {
                    mask.hide();
                  }, 600);
                });
              } else {
                $('.news').fadeOut(300);
                setTimeout(function() {
                  $('.news').html('<div class="load-text"></div>');
                  $('.news').fadeIn(300);
                }, 300);
                setTimeout(function() {
                  $('#load').fadeOut(300);
                  video.play();
                }, 2000);
                mask.hide();
                document.addEventListener("WeixinJSBridgeReady", function () {
                  video.play();
                  video.pause();
                  $video.on("loadstart",function(){
                    video.play();
                    video.pause();
                  });
                }, false);

              }
            } else {
              $('#load').fadeOut(300);
              //no wechat
              mask.on("click",function(){
                video.play();
                setTimeout(function() {
                  mask.hide();
                }, 600);
              });
            }
        }

      }).attr('src', "./" + val);
    });
  }

  function videoPlayEvents() {

    video.onended = function() {
      $('#end').fadeIn(300)
      $('.bg-text').addClass('text-animation');
    };

    /*$('#restart-btn').on("click",function(){
      $('#share').fadeIn(600);
    }); 

    $('#share').on("click",function(){
      $('#share').fadeOut(600);
    });*/

    $('#share-btn').on("click",function(){
      $('#next').fadeIn(600);
    }); 

    $('#next').on("click",function(){
      $('#next').fadeOut(600);
    }); 
  }
